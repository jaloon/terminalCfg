<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>移动网络参数</title>
    <link rel="stylesheet" href="css/base.css">
</head>
<body>
<div class="container">
    <table>
        <tr>
            <td>APN</td>
            <td>
                <input type="text" class="param" id="apn" placeholder="最大长度63">
            </td>
        </tr>
        <tr>
            <td>拨号中心号码</td>
            <td>
                <input type="text" class="param" id="cent" placeholder="最大长度63">
            </td>
        </tr>
        <tr>
            <td>用户名</td>
            <td>
                <input type="text" class="param" id="username" placeholder="最大长度63">
            </td>
        </tr>
        <tr>
            <td>密码</td>
            <td>
                <input type="text" class="param" id="password" placeholder="最大长度63">
            </td>
        </tr>
        <tr>
            <td>短信中心</td>
            <td>
                <input type="text" class="param" id="smscent" placeholder="最大长度63">
            </td>
        </tr>
        <tr>
            <td>PPP认证类型</td>
            <td>
                <select class="param" id="pppauth">
                    <option value="0">任意</option>
                    <option value="1">PAP</option>
                    <option value="2">CHAP</option>
                </select>
            </td>
        </tr>
        <tr>
            <td>重拨次数</td>
            <td>
                <input type="number" min="0" max="255" step="1" class="param" id="redial" placeholder="">
            </td>
        </tr>
        <tr>
            <td>重置次数</td>
            <td>
                <input type="number" min="0" max="255" step="1" class="param" id="reset" placeholder="">
            </td>
        </tr>
        <tr>
            <td>本地IP</td>
            <td>
                <input type="text" class="param" id="localip" placeholder="最大长度63">
            </td>
        </tr>
        <tr>
            <td>远程IP</td>
            <td>
                <input type="text" class="param" id="remoteip" placeholder="最大长度63">
            </td>
        </tr>
    </table>

    <input type="button" class="btn" id="submit" value="提交">
</div>
</body>
</html>
<script>
    function createXmlHttp() {
        var xmlhttp;
        if (window.XMLHttpRequest) {
            // code for IE7+, Firefox, Chrome, Opera, Safari
            xmlhttp = new XMLHttpRequest();
        } else {
            // code for IE6, IE5
            xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        return xmlhttp;
    }

    function ajaxGet(url, successFn) {
        var xmlhttp = createXmlHttp();
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState == 4) { // 4 = "loaded"
                if (xmlhttp.status == 200) { // 200 = "OK"
                    var response = JSON.parse(xmlhttp.responseText);
                    successFn(response);
                } else {
                    alert("http connection error: status[" + xmlhttp.status + "], " + xmlhttp.statusText);
                }
            }
        }
        xmlhttp.open("GET", url, true);
        xmlhttp.send();
    }

    function ajaxPost(url, data, successFn) {
        var xmlhttp = createXmlHttp();
        xmlhttp.onreadystatechange = function () {
            if (xmlhttp.readyState == 4) { // 4 = "loaded"
                if (xmlhttp.status == 200) { // 200 = "OK"
                    var response = JSON.parse(xmlhttp.responseText);
                    successFn(response);
                } else {
                    alert("http connection error: status[" + xmlhttp.status + "], " + xmlhttp.statusText);
                }
            }
        }
        xmlhttp.open("POST", url, true);
        xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xmlhttp.send(data);
    }

    function $(elementId) {
        return document.getElementById(elementId);
    }

    function bindEvent(element, event, fn) {
        if (element.addEventListener) {
            // 现代浏览器
            element.addEventListener(event, fn);
        } else if (element.attchEvent) {
            // IE8及更早版本和Opear 7.0及更早版本
            element.attchEvent(event, fn);
        }
    }

    window.onload = function () {
        var $apn = $("apn");
        var $cent = $("cent");
        var $username = $("username");
        var $password = $("password");
        var $smscent = $("smscent");
        var $pppauth = $("pppauth");
        var $redial = $("redial");
        var $reset = $("reset");
        var $localip = $("localip");
        var $remoteip = $("remoteip");
        ajaxGet("/action/param_mobile_get", function (response) {
            if (response.errno < 0) {
                alert(response.errmsg);
                return;
            }
            var data = response.datas[0];
            $apn.value = data.apn;
            $cent.value = data.cent;
            $username.value = data.username;
            $password.value = data.password;
            $smscent.value = data.smscent;
            $pppauth.value = data.pppauth;
            $redial.value = data.redial;
            $reset.value = data.reset;
            $localip.value = data.localip;
            $remoteip.value = data.remoteip;
        });

        bindEvent($("submit"), "click", function () {
            var apn = $apn.value;
            var cent = $cent.value;
            var username = $username.value;
            var password = $password.value;
            var smscent = $smscent.value;
            var pppauth = $pppauth.value;
            var redial = $redial.value;
            var reset = $reset.value;
            var localip = $localip.value;
            var remoteip = $remoteip.value;
            var data = "apn=" + apn + "&cent=" + cent + "&username=" + username + "&password=" + password +
                "&smscent=" + smscent + "&pppauth=" + pppauth + "&redial=" + redial + "&reset=" + reset +
                "&localip=" + localip + "&remoteip=" + remoteip;
            ajaxPost("/action/param_mobile_set", data, function (response) {
                if (response.errno < 0) {
                    alert(response.errmsg);
                    return;
                }
                alert("参数修改成功！");
            });
        });
    }
</script>